// File: /workspaces/repairradar/src/shared/modules/moduleImports.generated.ts

export const moduleImports={assets:()=>import("@/shared/modules/assets/components/AssetsPage"),calls:()=>import("@/shared/modules/calls/components/CallsPage"),inventory:()=>import("@/shared/modules/inventory/components/InventoryPage"),"preventative-maintenance":()=>import("@/shared/modules/preventative-maintenance/components/PreventativeMaintenancePage"),"work-orders":()=>import("@/shared/modules/work-orders/components/WorkOrdersPage")};

// File: /workspaces/repairradar/src/shared/modules/moduleManager.ts

import{moduleImports as s}from"./moduleImports.generated";export class ModuleManager{static getActiveModules(e){return!e||!e.modules||typeof e.modules!="object"?(console.warn("Invalid config or missing modules:",e),[]):(console.log("Config with modules:",e),Object.keys(e.modules).filter(o=>s[o]).map(o=>({name:o,component:s[o],apiRoute:`/api/${o}`})))}static getAllModules(){return console.log(Object.keys(s)),Object.keys(s)}}

// File: /workspaces/repairradar/src/shared/modules/preventative-maintenance/components/PreventativeMaintenancePage.tsx

"use client";import{useState as h,useEffect as A,useCallback as y}from"react";import{useSession as O}from"next-auth/react";import{useRouter as U}from"next/navigation";import{Button as f}from"@/components/ui/button";import{Input as v}from"@/components/ui/input";import{Badge as b}from"@/components/ui/badge";import{Card as W,CardContent as F,CardHeader as j,CardTitle as q,CardDescription as G}from"@/components/ui/card";import{Select as C,SelectContent as S,SelectItem as n,SelectTrigger as N,SelectValue as x}from"@/components/ui/select";import{Table as V,TableBody as $,TableCell as i,TableHead as c,TableHeader as z,TableRow as I}from"@/components/ui/table";import{toast as u}from"sonner";import{Loader2 as J,Plus as K,RefreshCw as Q,Search as X}from"lucide-react";import{usePMData as Y,useAssetData as Z,dynamicFetch as _}from"@/shared/lib/hooks";const ee=(s,r)=>`${r} ${s}${r>1?"s":""}`;export default function te({tenant:s}){const{status:r}=O(),T=U(),{data:w=[],isLoading:M,refetch:D}=Y(s),{data:k=[],isLoading:H,refetch:R}=Z(s),[o,L]=h(""),[E,g]=h(!1),[t,l]=h({description:"",recurrence:{type:"monthly",interval:1},nextRun:new Date().toISOString().slice(0,16),assetIds:[],priority:"MEDIUM"}),d=y(async()=>{try{await Promise.all([D(),R()]),u.success("Maintenance schedules and assets refreshed")}catch{u.error("Failed to refresh data")}},[D,R]),p=y(()=>w.filter(e=>{const a=e.description||"",m=e.assets.map(P=>P.asset.name||"").join(" ");return o===""||a.toLowerCase().includes(o.toLowerCase())||m.toLowerCase().includes(o.toLowerCase())}),[w,o]),B=y(async e=>{if(e.preventDefault(),!t.description||t.assetIds.length===0){u.error("Description and at least one asset are required");return}try{await _("preventative-maintenance",s,"POST",{body:{subdomain:s,...t}}),l({description:"",recurrence:{type:"monthly",interval:1},nextRun:new Date().toISOString().slice(0,16),assetIds:[],priority:"MEDIUM"}),g(!1),await d(),u.success("Maintenance scheduled successfully")}catch(a){u.error(a instanceof Error?a.message:"Failed to schedule maintenance")}},[t,s,d]);return A(()=>{r!=="loading"&&(r==="unauthenticated"?T.push("/auth/signin"):r==="authenticated"&&d())},[r,T,d]),M||H||r==="loading"?React.createElement("div",{className:"flex items-center justify-center h-screen"},React.createElement(J,{className:"h-8 w-8 animate-spin"})):React.createElement("div",{className:"space-y-6 p-6"},React.createElement("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},React.createElement("div",null,React.createElement("h1",{className:"text-3xl font-bold"},"Preventative Maintenance - ",s),React.createElement("p",{className:"text-sm text-muted-foreground"},"Schedule and manage maintenance tasks")),React.createElement("div",{className:"flex gap-2"},React.createElement(f,{variant:"outline",onClick:d,disabled:M||H},React.createElement(Q,{className:"h-4 w-4 mr-2"}),"Refresh"),React.createElement(f,{onClick:()=>g(!0)},React.createElement(K,{className:"h-4 w-4 mr-2"}),"New Schedule"))),React.createElement(W,null,React.createElement(j,null,React.createElement("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},React.createElement("div",null,React.createElement(q,null,"Maintenance Schedules"),React.createElement(G,null,p().length," ",p().length===1?"schedule":"schedules"," found")),React.createElement("div",{className:"relative"},React.createElement(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),React.createElement(v,{placeholder:"Search by description or asset...",className:"pl-9 w-full md:w-64",value:o,onChange:e=>L(e.target.value)})))),React.createElement(F,null,E&&React.createElement("form",{onSubmit:B,className:"mb-6 p-4 border rounded-lg bg-muted/50"},React.createElement("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},React.createElement("div",{className:"col-span-1 md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium mb-1"},"Description *"),React.createElement(v,{value:t.description,onChange:e=>l({...t,description:e.target.value}),placeholder:"Describe the maintenance task...",required:!0})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Recurrence Type *"),React.createElement(C,{value:t.recurrence.type,onValueChange:e=>l({...t,recurrence:{...t.recurrence,type:e}})},React.createElement(N,null,React.createElement(x,null)),React.createElement(S,null,React.createElement(n,{value:"daily"},"Daily"),React.createElement(n,{value:"weekly"},"Weekly"),React.createElement(n,{value:"monthly"},"Monthly")))),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Interval *"),React.createElement(v,{type:"number",value:t.recurrence.interval,onChange:e=>l({...t,recurrence:{...t.recurrence,interval:parseInt(e.target.value)||1}}),min:"1",placeholder:"Interval",required:!0})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Next Run *"),React.createElement(v,{type:"datetime-local",value:t.nextRun,onChange:e=>l({...t,nextRun:e.target.value}),required:!0})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Priority"),React.createElement(C,{value:t.priority,onValueChange:e=>l({...t,priority:e})},React.createElement(N,null,React.createElement(x,null)),React.createElement(S,null,React.createElement(n,{value:"LOW"},"Low"),React.createElement(n,{value:"MEDIUM"},"Medium"),React.createElement(n,{value:"HIGH"},"High")))),React.createElement("div",{className:"col-span-1 md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium mb-1"},"Assets *"),React.createElement(C,{onValueChange:e=>{t.assetIds.includes(e)||l({...t,assetIds:[...t.assetIds,e]})}},React.createElement(N,null,React.createElement(x,{placeholder:"Add an asset"})),React.createElement(S,null,k.filter(e=>!t.assetIds.includes(e.id)).map(e=>React.createElement(n,{key:e.id,value:e.id},e.name)))),t.assetIds.length>0&&React.createElement("div",{className:"mt-2 flex flex-wrap gap-2"},t.assetIds.map(e=>{const a=k.find(m=>m.id===e);return a?React.createElement(b,{key:e,variant:"secondary",className:"flex items-center gap-1"},a.name,React.createElement("button",{type:"button",onClick:()=>l({...t,assetIds:t.assetIds.filter(m=>m!==e)}),className:"text-muted-foreground hover:text-destructive"},"\xD7")):null}))),React.createElement("div",{className:"flex items-end gap-2"},React.createElement(f,{type:"submit",disabled:!t.description||t.assetIds.length===0},"Schedule"),React.createElement(f,{variant:"outline",type:"button",onClick:()=>g(!1)},"Cancel")))),React.createElement(V,null,React.createElement(z,null,React.createElement(I,null,React.createElement(c,null,"Description"),React.createElement(c,null,"Assets"),React.createElement(c,null,"Recurrence"),React.createElement(c,null,"Next Run"),React.createElement(c,null,"Priority"),React.createElement(c,null,"Status"))),React.createElement($,null,p().length===0?React.createElement(I,null,React.createElement(i,{colSpan:6,className:"text-center py-6"},o?"No matching schedules found":"No schedules available")):p().map(e=>React.createElement(I,{key:e.id},React.createElement(i,{className:"font-medium"},e.description||"N/A"),React.createElement(i,null,React.createElement("div",{className:"flex flex-wrap gap-1"},e.assets.length>0?e.assets.map(({asset:a})=>React.createElement(b,{key:a.id,variant:"outline"},a.name)):React.createElement("span",{className:"text-muted-foreground"},"None"))),React.createElement(i,null,ee(e.recurrence.type,e.recurrence.interval)),React.createElement(i,null,new Date(e.nextRun).toLocaleString()),React.createElement(i,null,React.createElement(b,{variant:e.priority==="HIGH"?"destructive":e.priority==="MEDIUM"?"secondary":"default"},e.priority.charAt(0)+e.priority.slice(1).toLowerCase())),React.createElement(i,null,React.createElement(b,{variant:e.status==="COMPLETED"?"default":e.status==="SCHEDULED"?"secondary":"outline"},e.status.charAt(0)+e.status.slice(1).toLowerCase())))))))))}

// File: /workspaces/repairradar/src/shared/modules/preventative-maintenance/types.ts


// File: /workspaces/repairradar/src/shared/modules/types.ts

export*from"@prisma/client";

// File: /workspaces/repairradar/src/shared/modules/work-orders/components/WorkOrdersPage.tsx

"use client";import{useState as d,useEffect as Z,useCallback as g}from"react";import{useSession as $}from"next-auth/react";import{useRouter as ee}from"next/navigation";import{Button as h}from"@/components/ui/button";import{Input as T}from"@/components/ui/input";import{Badge as k}from"@/components/ui/badge";import{Card as te,CardContent as re,CardHeader as ae,CardTitle as se,CardDescription as le}from"@/components/ui/card";import{Select as D,SelectContent as y,SelectItem as m,SelectTrigger as N,SelectValue as S}from"@/components/ui/select";import{Table as oe,TableBody as ie,TableCell as n,TableHead as p,TableHeader as de,TableRow as I}from"@/components/ui/table";import{toast as l}from"sonner";import{ChevronDown as ne,Edit as ce,Loader2 as ue,Plus as me,RefreshCw as pe,Search as fe,Trash2 as ge}from"lucide-react";import{EditDialog as he}from"@/components/EditDialog";import{DropdownMenu as be,DropdownMenuContent as ve,DropdownMenuItem as B,DropdownMenuTrigger as Ce}from"@/components/ui/dropdown-menu";import{useWorkOrderData as ke,useAssetData as De,dynamicFetch as W}from"@/shared/lib/hooks";const F=a=>a.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" ");export default function ye({tenant:a}){const{status:o}=$(),E=ee(),{data:x=[],isLoading:P,refetch:L}=ke(a),{data:M=[],isLoading:A,refetch:H}=De(a),[c,U]=d(""),[b,G]=d("all"),[v,j]=d("all"),[q,w]=d(!1),[V,O]=d(!1),[i,R]=d(null),[t,u]=d({description:"",assetIds:[],priority:"MEDIUM",dueDate:""}),s=g(async()=>{try{await Promise.all([L(),H()]),l.success("Work orders and assets refreshed")}catch{l.error("Failed to refresh data")}},[L,H]),C=g(()=>x.filter(e=>{const r=e.description||"",f=e.assets.map(Y=>Y.asset.name||"").join(" "),K=c===""||r.toLowerCase().includes(c.toLowerCase())||f.toLowerCase().includes(c.toLowerCase()),Q=b==="all"||e.status===b,X=v==="all"||e.priority===v;return K&&Q&&X}).sort((e,r)=>new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime()),[x,c,b,v]),_=g(async e=>{if(e.preventDefault(),!t.description||t.assetIds.length===0){l.error("Description and at least one asset are required");return}try{await W("work-orders",a,"POST",{body:{subdomain:a,...t}}),u({description:"",assetIds:[],priority:"MEDIUM",dueDate:""}),w(!1),await s(),l.success("Work order created successfully")}catch(r){l.error(r instanceof Error?r.message:"Failed to create work order")}},[t,a,s]),z=g(async e=>{if(i)try{await W("work-orders",a,"PUT",{id:i.id,body:e}),await s(),O(!1),l.success("Work order updated successfully")}catch(r){l.error(r instanceof Error?r.message:"Failed to update work order")}},[i,a,s]),J=g(async e=>{if(confirm("Are you sure you want to delete this work order?"))try{await W("work-orders",a,"DELETE",{id:e}),await s(),l.success("Work order deleted successfully")}catch(r){l.error(r instanceof Error?r.message:"Failed to delete work order")}},[a,s]);return Z(()=>{o!=="loading"&&(o==="unauthenticated"?E.push("/auth/signin"):o==="authenticated"&&s())},[o,E,s]),P||A||o==="loading"?React.createElement("div",{className:"flex items-center justify-center h-screen"},React.createElement(ue,{className:"h-8 w-8 animate-spin"})):React.createElement("div",{className:"space-y-6 p-6"},React.createElement("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},React.createElement("div",null,React.createElement("h1",{className:"text-3xl font-bold"},"Work Orders - ",a),React.createElement("p",{className:"text-sm text-muted-foreground"},"Manage maintenance and service requests")),React.createElement("div",{className:"flex gap-2"},React.createElement(h,{variant:"outline",onClick:s,disabled:P||A},React.createElement(pe,{className:"h-4 w-4 mr-2"}),"Refresh"),React.createElement(h,{onClick:()=>w(!0)},React.createElement(me,{className:"h-4 w-4 mr-2"}),"New Work Order"))),React.createElement(te,null,React.createElement(ae,null,React.createElement("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},React.createElement("div",null,React.createElement(se,null,"Work Orders"),React.createElement(le,null,C().length," ",C().length===1?"order":"orders"," found")),React.createElement("div",{className:"flex flex-col md:flex-row gap-3"},React.createElement("div",{className:"relative"},React.createElement(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),React.createElement(T,{placeholder:"Search by description or asset...",className:"pl-9 w-full md:w-64",value:c,onChange:e=>U(e.target.value)})),React.createElement(D,{value:b,onValueChange:e=>G(e)},React.createElement(N,{className:"w-full md:w-40"},React.createElement(S,{placeholder:"Filter by Status"})),React.createElement(y,null,React.createElement(m,{value:"all"},"All Statuses"),["PENDING","IN_PROGRESS","COMPLETED","CANCELLED"].map(e=>React.createElement(m,{key:e,value:e},F(e))))),React.createElement(D,{value:v,onValueChange:e=>j(e)},React.createElement(N,{className:"w-full md:w-40"},React.createElement(S,{placeholder:"Filter by Priority"})),React.createElement(y,null,React.createElement(m,{value:"all"},"All Priorities"),["LOW","MEDIUM","HIGH"].map(e=>React.createElement(m,{key:e,value:e},e.charAt(0)+e.slice(1).toLowerCase()))))))),React.createElement(re,null,q&&React.createElement("form",{onSubmit:_,className:"mb-6 p-4 border rounded-lg bg-muted/50"},React.createElement("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},React.createElement("div",{className:"col-span-1 md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium mb-1"},"Description *"),React.createElement(T,{value:t.description,onChange:e=>u({...t,description:e.target.value}),placeholder:"Describe the work needed...",required:!0})),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Priority *"),React.createElement(D,{value:t.priority,onValueChange:e=>u({...t,priority:e})},React.createElement(N,null,React.createElement(S,null)),React.createElement(y,null,["LOW","MEDIUM","HIGH"].map(e=>React.createElement(m,{key:e,value:e},e.charAt(0)+e.slice(1).toLowerCase()))))),React.createElement("div",null,React.createElement("label",{className:"block text-sm font-medium mb-1"},"Due Date"),React.createElement(T,{type:"date",value:t.dueDate,onChange:e=>u({...t,dueDate:e.target.value})})),React.createElement("div",{className:"col-span-1 md:col-span-2"},React.createElement("label",{className:"block text-sm font-medium mb-1"},"Assets *"),React.createElement(D,{onValueChange:e=>{t.assetIds.includes(e)||u({...t,assetIds:[...t.assetIds,e]})}},React.createElement(N,null,React.createElement(S,{placeholder:"Add an asset"})),React.createElement(y,null,M.filter(e=>!t.assetIds.includes(e.id)).map(e=>React.createElement(m,{key:e.id,value:e.id},e.name)))),t.assetIds.length>0&&React.createElement("div",{className:"mt-2 flex flex-wrap gap-2"},t.assetIds.map(e=>{const r=M.find(f=>f.id===e);return r?React.createElement(k,{key:e,variant:"secondary",className:"flex items-center gap-1"},r.name,React.createElement("button",{type:"button",onClick:()=>u({...t,assetIds:t.assetIds.filter(f=>f!==e)}),className:"text-muted-foreground hover:text-destructive"},"\xD7")):null}))),React.createElement("div",{className:"flex items-end gap-2"},React.createElement(h,{type:"submit",disabled:!t.description||t.assetIds.length===0},"Create"),React.createElement(h,{variant:"outline",type:"button",onClick:()=>w(!1)},"Cancel")))),React.createElement(oe,null,React.createElement(de,null,React.createElement(I,null,React.createElement(p,null,"Description"),React.createElement(p,null,"Assets"),React.createElement(p,null,"Priority"),React.createElement(p,null,"Status"),React.createElement(p,null,"Due Date"),React.createElement(p,{className:"text-right"},"Actions"))),React.createElement(ie,null,C().length===0?React.createElement(I,null,React.createElement(n,{colSpan:6,className:"text-center py-6"},c?"No matching work orders found":"No work orders available")):C().map(e=>React.createElement(I,{key:e.id},React.createElement(n,{className:"font-medium"},e.description||"N/A"),React.createElement(n,null,React.createElement("div",{className:"flex flex-wrap gap-1"},e.assets.length>0?e.assets.map(({asset:r})=>React.createElement(k,{key:r.id,variant:"outline"},r.name)):React.createElement("span",{className:"text-muted-foreground"},"None"))),React.createElement(n,null,React.createElement(k,{variant:e.priority==="HIGH"?"destructive":e.priority==="MEDIUM"?"secondary":"default"},e.priority.charAt(0)+e.priority.slice(1).toLowerCase())),React.createElement(n,null,React.createElement(k,{variant:e.status==="COMPLETED"?"default":e.status==="IN_PROGRESS"?"secondary":e.status==="CANCELLED"?"destructive":"outline"},F(e.status))),React.createElement(n,null,e.dueDate?new Date(e.dueDate).toLocaleDateString():"Not set"),React.createElement(n,{className:"text-right"},React.createElement(be,null,React.createElement(Ce,{asChild:!0},React.createElement(h,{variant:"ghost",size:"sm"},React.createElement(ne,{className:"h-4 w-4"}))),React.createElement(ve,{align:"end"},React.createElement(B,{onClick:()=>{R(e),O(!0)}},React.createElement(ce,{className:"h-4 w-4 mr-2"}),"Edit"),React.createElement(B,{onClick:()=>J(e.id),className:"text-destructive"},React.createElement(ge,{className:"h-4 w-4 mr-2"}),"Delete")))))))))),React.createElement(he,{open:V,onOpenChange:e=>{O(e),e||R(null)},title:"Edit Work Order",description:"Update work order details",initialData:{description:i?.description||"",priority:i?.priority||"MEDIUM",status:i?.status||"PENDING",dueDate:i?.dueDate?new Date(i.dueDate).toISOString().split("T")[0]:""},fields:[{name:"description",label:"Description",type:"text",required:!0},{name:"priority",label:"Priority",type:"select",options:[{value:"LOW",label:"Low"},{value:"MEDIUM",label:"Medium"},{value:"HIGH",label:"High"}]},{name:"status",label:"Status",type:"select",options:[{value:"PENDING",label:"Pending"},{value:"IN_PROGRESS",label:"In Progress"},{value:"COMPLETED",label:"Completed"},{value:"CANCELLED",label:"Cancelled"}]},{name:"dueDate",label:"Due Date",type:"date",required:!0}],onSubmit:z}))}

